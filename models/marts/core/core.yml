version: 2

models:
  - name: dim_products
    description: "modelo generado a partir de la stg_products"
    columns:
      - name: id_product
        data_type: varchar
        description: "El identificador único de los productos"
        tests:
          - not_null
          - unique

      - name: price_$
        data_type: float
        description: "precio del producto"
    
      - name: name
        data_type: varchar
        description: "nombre del producto"

      - name: inventory
        data_type: number
        description: "cantidad de producto"

      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion"

  - name: dim_addresses
    description: "modelo generado a partir de la stg_addresses"
    columns:
      - name: id_address
        data_type: varchar
        description: "El identificador único de la dirección"

      - name: zipcode
        data_type: number
        description: "codigo postal de la dirección"

      - name: country
        data_type: varchar
        description: "columna referente al país de la dirección"

      - name: address
        data_type: varchar
        description: "nombre de la dirección"

      - name: state
        data_type: varchar
        description: "nombre del estado de la dirección"

      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de los datos"

  - name: dim_event_type
    description: "Este modelo se ha generado a partir de la stg_event_type."
    columns:
      - name: id_event_type
        data_type: varchar
        description: "El identificador único del tipo de evento"

      - name: desc_event_type
        data_type: varchar
        description: "nombres de los ditintos tipos de eventos"

  - name: dim_products
    description: "Este modelo se ha generado a partir de stg_products."
    columns:
      - name: id_product
        data_type: varchar
        description: "identificador unico del producto"
        tests:
          - unique
          - not_null

      - name: price_$
        data_type: float
        description: "preio del producto"

      - name: name
        data_type: varchar
        description: "nombre del producto"

      - name: inventory
        data_type: number
        description: "cantidad de producto"

      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de los datos"

  - name: dim_promos
    description: "Este modelo se ha generado a partir de stg_promos"
    columns:
      - name: desc_promo
        data_type: varchar
        description: " nombre de la promocion"

      - name: id_promo
        data_type: varchar
        description: "identificador único de la promoción"
        tests:
          - unique
          - not_null

      - name: status
        data_type: varchar
        description: "estado de la promocion"

      - name: discount
        data_type: number
        description: "cantidad de descuento de la promocion"

      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de datos"

  - name: dim_tiempo
    description: "tabla de fechas generada a partir del uso del paquete dbt_utils/date_spine"
    columns:
      - name: fecha_forecast
        data_type: date
        description: "fecha de pronostico"

      - name: id_date
        data_type: number
        description: "El identificador único de la fecha"
        

      - name: anio
        data_type: number
        description: "año de la fecha"
        tests:
          - not_null

      - name: mes
        data_type: number
        description: "mes de la fecha"
        tests:
          - not_null

      - name: desc_mes
        data_type: varchar
        description: " nombre del mes"
        tests:
          - not_null

      - name: id_anio_mes
        data_type: number
        description: "El identificador único del año y mes de la fecha"
        tests:
          - not_null

      - name: dia_previo
        data_type: date
        description: "la fecah del dia previo"
        tests:
          - not_null

      - name: anio_semana_dia
        data_type: varchar
        description: "anio semana y dia de la fecha"
        tests:
          - not_null

      - name: semana
        data_type: number
        description: "semana de la fecha"
        tests:
          - not_null

  - name: dim_users
    description: "Este modelo se ha generado a partir de stg_users."
    columns:
      - name: id_user
        data_type: varchar
        description: "identificador unico del usuario"
        tests:
          - unique
          - not_null

      - name: updated_at_utc
        data_type: timestamp_ltz
        description: "fecha de actualizacion"
        
      - name: id_address
        data_type: varchar
        description: "identificador unico de la direccion relacionado con usuarios"
        
      - name: last_name
        data_type: varchar
        description: "apellidos"

      - name: created_at_utc
        data_type: timestamp_ltz
        description: "feacha de creacion"
  
      - name: phone_number
        data_type: varchar
        description: "numero de telefono de los usuarios"
        
      - name: total_orders
        data_type: number
        description: "total de orders realizado por un usuario"
        
      - name: first_name
        data_type: varchar
        description: "nombre de los usuarios"
        
      - name: email
        data_type: varchar
        description: "correo electronico de usuarios"
        
      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de los datos"
        
          
  - name: fact_events
    description: "Este modelo se ha generado a partir de stg_sql_server_dbo_events."
    columns:
      - name: id_event
        data_type: varchar
        description: "identificador unico del evento"
        tests:
          - unique
          - not_null

      - name: page_url
        data_type: varchar
        description: "url de la pagina del negocio"
        tests:
          - not_null

      - name: id_event_type
        data_type: varchar
        description: "identificador unico del tipo de evento"
        tests:
          - not_null
          - relationships:
              field: id_event_type
              to: ref('dim_event_type')

      - name: id_user
        data_type: varchar
        description: "identificador unico del usuario relacionado con el evento"
        tests:
          - not_null
          - relationships:
              field: id_user
              to: ref('dim_users')

      - name: id_product
        data_type: varchar
        description: "identificador unico del producto relacionado con el evento"
        tests:
          - not_null
          - relationships:
              field: <id_product>
              to: ref('dim_product')

      - name: id_session
        data_type: varchar
        description: "identificador único de la sesion relacionado con el evento"

      - name: created_at_utc
        data_type: timestamp_ltz
        description: "fecha de creacion del evento"
      
      - name: id_order
        data_type: varchar
        description: "identificador unico de la order relacionado con el evento "
        
      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de los datos"
        
          
  - name: fact_orders
    description: "Este modelo se ha generado a partir de stg_orders."
    columns:
      - name: id_order
        data_type: varchar
        description: "El identificador único de las orders"
        tests:
          - not_null
          - unique

      - name: shipping_service
        data_type: varchar
        description: "compañia de reparto"
        
      - name: shipping_cost_$
        data_type: float
        description: "coste de reparto"
        
      - name: id_address
        data_type: varchar
        description: "El identificador único de las direcciones"
        tests:
          - not_null
          - relationships:
              field: id_address
              to: ref('dim_address')

      - name: created_at_utc
        data_type: timestamp_ltz
        description: "fecha de la creacion de la order"
       
      - name: id_promo
        data_type: varchar
        description: "El identificador único de las promociones relacionadas con orders"
        tests:
          - dbt_utils.relationships_where:
                  to: ref('dim_promos')
                  field: id_promo
                  from_condition: id_promo <> '9999'
      - name: estimated_delivery_at_utc
        data_type: timestamp_ltz
        description: "tiempo estimado de envio"
       
      - name: order_cost_$
        data_type: float
        description: "costo de la order"
      
      - name: id_user
        data_type: varchar
        description: "El identificador único de los usuarios relacionados con orders"
        tests:
          - not_null
          - relationships:
              field: id_user
              to: ref('dim_users')

      - name: order_total_$
        data_type: float
        description: "costo total de una orden"
    
      - name: delivered_at
        data_type: timestamp_ltz
        description: "fecah de entrega"
      
      - name: id_tracking
        data_type: varchar
        description: "indetificador unico de seguimiento"
     
      - name: _fivetran_synced
        data_type: timestamp_tz
        description: "fecha de sincronizacion de los datos"

  - name: agg_total_sales_products_state
    description: "tabla agregada respecto al caso de uso en el que se obtinen los datos de el total de ventas por producto  y estado"
    columns:
      - name: state
        data_type: varchar
        description: "nombre del estado de la dirección"

      - name: id_product
        data_type: varchar
        description: "El identificador único de los usuarios"
        tests:
          - relationships:
              field: id_product
              to: ref('dim_product')

      - name: product_name
        data_type: varchar
        description: "nombre del producto"

      - name: sum(order_total_$)
        data_type: float
        description: "total de ventas "
    

  - name: agg_stocktacking_costs
    description: "tabla agregada respecto al caso de uso en el que se obtinen los datos para el control de inventario y costos "
    columns:
      - name: id_order
        data_type: varchar
        description: "El identificador único de los pedidos"
        tests:
          - not_null
              
      - name: id_product
        data_type: varchar
        description: "El identificador único de los productos"
        tests:
          - relationships:
              field: id_product
              to: ref('dim_product')

      - name: product_name
        data_type: varchar
        description: "nombre del producto"
        tests:
          - not_null

      - name: quantity
        data_type: number
        description: "cantidad del producto respecto a un pedido en concreto"

      - name: inventory_quantity
        data_type: number
        description: "cantidad de productos en inventario"
        tests:
          - positive_value
      - name: month
        data_type: varchar
        description: "mes"
        tests:
          - not_null

      - name: product_price
        data_type: float
        description: "precio del producto"

      - name: promo_status
        data_type: varchar
        description: "estado de la promocion"

      - name: promo_discount
        data_type: number
        description: "descuento de la promocion"

      - name: total_order_value
        data_type: float
        description: "valor total de pedios"
        tests:
          - positive_value

      - name: net_sales
        data_type: float
        description: "ventas netas"

  - name: agg_events_users
    description: "tabla agregada respecto al caso de uso en el que se obtinen los datos para el seguimineto de eventos respecto a los usuarios"
    columns:
      - name: id_event
        data_type: varchar
        description: "identificador unico de los eventos"
        tests:
          - not_null
          - unique
      - name: id_user
        data_type: varchar
        description: "identificador unico de los usuarios"
        tests:
          - relationships:
              to: ref('dim_users')
              field: id_user

      - name: first_name
        data_type: varchar
        description: "nombre usuario"

      - name: last_name
        data_type: varchar
        description: "apellido usuario"

      - name: page_url
        data_type: varchar
        description: "url de la pagina web del negocio respecto al tipo de evento"

      - name: desc_event_type
        data_type: varchar
        description: "tipo de envento que se realiza en una pagina web"
        

      - name: ultima_actividad
        data_type: date
        description: "fecha de la ultima activad del usuario en la pagina web"

      - name: id_product
        data_type: varchar
        description: "identificador unico del producto"
        tests:
          - relationships:
              to: ref('dim_product')
              field: id_product
        

      - name: product_name
        data_type: varchar
        description: "nombre del producto"

      - name: created_at
        data_type: date
        description: "fecha de creacion del evento "
       